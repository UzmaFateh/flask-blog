<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{{ post.title }} - My Blog</title>
    <script src="https://cdn.tailwindcss.com"></script>





</head>

<body class="bg-gray-50 text-gray-800">
    {% extends "base.html" %}
    {% block content %}
    <!-- Page content here -->


    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Post Title -->
        <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 mb-3">{{ post.title }}</h1>

        <!-- Timestamp + Category -->
        <p class="text-xs sm:text-sm text-gray-500 mb-4">
            Posted on {{ post.created_at.strftime('%B %d, %Y at %I:%M %p') }} |
            <span class="font-semibold">Category:</span>
            <a href="{{ url_for('posts_by_category', category_name=post.category) }}">
                <span class="bg-blue-100 text-blue-800 text-[10px] sm:text-xs font-medium px-2 py-1 rounded">
                    {{ post.category }}
                </span>
            </a>
        </p>

        <!-- Share Button -->
        <button
            class="bg-blue-600 hover:bg-blue-700 text-white text-xs sm:text-sm px-3 sm:px-4 py-1.5 sm:py-2 rounded-md flex items-center gap-2 mb-6 share-btn"
            data-title="{{ post.title }}" data-url="{{ url_for('post_detail', slug=post.slug, _external=True) }}">
            üì¢ <span>Share</span>
        </button>

        <!-- Post Image -->
        {% if post.image_filename %}
        <!-- ‚úÖ CHANGED: Local path removed, now using Cloudinary helper function -->
        <img src="{{ get_cloudinary_url(post.image_filename, width=1200, height=600) }}" alt="{{ post.title }}"
            class="w-full sm:w-4/5 lg:w-2/3 mx-auto rounded-lg shadow-md mb-6 object-cover">
        {% endif %}

        <!-- Post Content -->
        <!-- content_html mein Markdown se converted content hoga, jo app.py mein sanitize ho chuka hai -->
        <div class="prose max-w-none prose-sm sm:prose lg:prose-lg mb-8">
            {{ content_html }}
        </div>

        <hr class="my-8 border-gray-300">

        <!-- Comment Form -->
        <div class="mb-8">
            <h3 class="text-lg font-semibold mb-4">Leave a Comment</h3>
            <form action="{{ url_for('post_detail', slug=post.slug) }}" method="post" class="space-y-4">
                <input type="text" name="name" placeholder="Your name" required
                    class="w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-500">

                <textarea name="message" placeholder="Your comment..." required
                    class="w-full border border-gray-300 rounded-md p-2 h-28 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>

                <input type="submit" value="Post Comment"
                    class="bg-green-600 hover:bg-green-700 text-white text-sm sm:text-base px-4 py-2 rounded-md cursor-pointer">
            </form>
        </div>

        <!-- Comment List -->
        <div>
            <h3 class="text-lg font-semibold mb-4">Comments ({{ comments|length }})</h3>
            {% for comment in comments %}
            <div class="border-t border-gray-200 py-4">
                <p class="font-semibold text-sm sm:text-base">{{ comment.name }}</p>
                <p class="text-[10px] sm:text-xs text-gray-500 mb-1">{{ comment.created_at.strftime('%B %d, %Y at %I:%M
                    %p') }}</p>
                <p class="text-gray-700 text-sm sm:text-base">{{ comment.message }}</p>
            </div>
            {% endfor %}
        </div>

        <!-- Back to Home -->
        <div class="mt-8">
            <a href="{{ url_for('index') }}" class="text-blue-600 hover:underline text-sm sm:text-base">‚Üê Back to
                Home</a>
        </div>
    </div>

    <!-- Custom Message Box for Copy Confirmation -->
    <div id="copy-message"
        class="fixed bottom-5 right-5 bg-green-600 text-white px-4 py-2 rounded-lg shadow-xl hidden transition-opacity duration-300 z-50">
        Link copied to clipboard!
    </div>

    <script>
        // Custom message box function (replaces alert)
        function showCopyMessage() {
            const msg = document.getElementById('copy-message');
            msg.classList.remove('hidden');
            setTimeout(() => {
                msg.classList.add('hidden');
            }, 2000); // Message will hide after 2 seconds
        }

        document.addEventListener("DOMContentLoaded", function () {
            const shareBtn = document.querySelector(".share-btn");
            if (shareBtn) {
                shareBtn.addEventListener("click", function () {
                    const title = this.dataset.title;
                    const url = this.dataset.url;

                    if (navigator.share) {
                        // Use native Web Share API
                        navigator.share({
                            title: title,
                            url: url
                        }).catch(err => console.log("Share failed:", err));
                    } else {
                        // Fallback: Copy to clipboard using execCommand and show custom message
                        const tempInput = document.createElement('textarea');
                        tempInput.value = url;
                        tempInput.style.position = 'fixed'; 
                        tempInput.style.opacity = '0';
                        document.body.appendChild(tempInput);
                        tempInput.select();
                        document.execCommand('copy');
                        document.body.removeChild(tempInput);
                        
                        // Show the custom confirmation message
                        showCopyMessage();
                    }
                });
            }
        });
    </script>
    {% endblock %}

</body>

</html>